<!DOCTYPE html>
<html>
  <head>
    <title>NETWORK FOR THE STUDY OF ARCHAIC AND CLASSICAL GREEK SONG -- GREEK LYRIC POETS MAP | CartoDB.js</title>

    <link type="text/css" rel="stylesheet" href="orbis.css" />
    <link type="text/css" rel="stylesheet" href="lyricmapping.css" />
    <link type="text/css" rel="stylesheet" href="chosen.min.css" />
    <link rel="stylesheet" href="css/iThing.css" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Gentium+Basic:400,700' rel='stylesheet' type='text/css'>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css" />
    <![endif]-->
    
</head>
  
<body>
  
  <div id="map"></div>

  <div class="controlsDiv" id="controlbar">
    <div id="controlbarScroller";>
      
    <div id="modeSelection">
      <div class="mainlinksDiv" id="navbar_selected">
	<a class="mainlinks" href="bubblemap.html">PLACES</a>
      </div>  
      <div style="float:right" class="mainlinksDiv">
	<a style="border-bottom: 4px solid; border-bottom-color: #c72f2a;" class="mainlinks" href="linemap.html">TRAVEL</a>
      </div>
    </div>
      
    <div class="buttonContainer" style="background: white; height: 150px;">            
      <fieldset style="border: none;" id="cityForm" class="priorityForm">
        <div style="color:gray;padding-right:5px;display: inline-block;margin-top: 3px;" >POET: </div>
		
        <input type="radio" value="0" name="city" id="poet_92">
        <label for="poet_92" class="priority-picker-label">Alcaeus</label>
	
        <input type="radio" value="0" name="city" id="poet_93">
        <label for="poet_93" class="priority-picker-label">Alcman</label>
	
        <input type="radio" value="0" name="city" id="poet_94">
        <label for="poet_94" class="priority-picker-label">Anacreon</label>
	
        <input type="radio" value="0" name="city" id="poet_96">
        <label for="poet_96" class="priority-picker-label">Apollodorus</label>
	
        <input type="radio" value="0" name="city" id="poet_97">
        <label for="poet_97" class="priority-picker-label">Archilochus</label>
	
        <input type="radio" value="0" name="city" id="poet_98">
        <label for="poet_98" class="priority-picker-label">Arion</label>
	
        <input type="radio" value="0" name="city" id="poet_23">
        <label for="poet_23" class="priority-picker-label">Ariphron</label>
	
        <input type="radio" value="0" name="city" id="poet_100">
        <label for="poet_100" class="priority-picker-label">Bacchylides</label>
	
        <input type="radio" value="0" name="city" id="poet_11">
        <label for="poet_11" class="priority-picker-label">Bakkhiadas</label>
	
        <input type="radio" value="1" name="city" id="poet_107">
        <label for="poet_107" class="priority-picker-label">Demodocus</label>
	
        <input type="radio" value="0" name="city" id="poet_59">
        <label for="poet_59" class="priority-picker-label">Diagoras</label>
	
        <input type="radio" value="2" name="city" id="poet_61">
        <label for="poet_61" class="priority-picker-label">Dion</label>	
	
		<input type="radio" value="0" name="city" id="poet_109">
        <label for="poet_109" class="priority-picker-label">Dionysius Chalkus</label>
	
		<input type="radio" value="0" name="city" id="poet_62">
        <label for="poet_62" class="priority-picker-label">Dionysius of Chios</label>
	
        <input type="radio" value="0" name="city" id="poet_111">
        <label for="poet_111" class="priority-picker-label">Echembrotus</label>
	
        <input type="radio" value="1" name="city" id="poet_43">
        <label for="poet_43" class="priority-picker-label">Euangelos</label>
	
        <input type="radio" value="2" name="city" id="poet_112">
        <label for="poet_112" class="priority-picker-label">Eumelos #1</label>
	
        <input type="radio" value="2" name="city" id="poet_44">
        <label for="poet_44" class="priority-picker-label">Eumelos #2</label>
	
        <input type="radio" value="2" name="city" id="poet_113">
        <label for="poet_113" class="priority-picker-label">Eunicus</label>
		
        <input type="radio" value="2" name="city" id="poet_114">
        <label for="poet_114" class="priority-picker-label">Euripides</label>
	
        <input type="radio" value="2" name="city" id="poet_42">
        <label for="poet_42" class="priority-picker-label">Exekestides</label>
		
        <input type="radio" value="2" name="city" id="poet_115">
        <label for="poet_115" class="priority-picker-label">Hermippus</label>
	
        <input type="radio" value="2" name="city" id="poet_116">
        <label for="poet_116" class="priority-picker-label">Hipponax</label>
	
        <input type="radio" value="2" name="city" id="poet_117">
        <label for="poet_117" class="priority-picker-label">Ibycus</label>
	
        <input type="radio" value="0" name="city" id="poet_55">
        <label for="poet_55" class="priority-picker-label">Ion of Chios</label>
	
        <input type="radio" value="1" name="city" id="poet_51">
        <label for="poet_51" class="priority-picker-label">Khairis</label>
	
        <input type="radio" value="2" name="city" id="poet_20">
        <label for="poet_20" class="priority-picker-label">Krateuas</label>
	
		<input type="radio" value="0" name="city" id="poet_47">
        <label for="poet_47" class="priority-picker-label">Kydides</label>
	
        <input type="radio" value="2" name="city" id="poet_120">
        <label for="poet_120" class="priority-picker-label">Lamprus</label>
	
        <input type="radio" value="2" name="city" id="poet_121">
        <label for="poet_121" class="priority-picker-label">Lasus</label>
	
        <input type="radio" value="1" name="city" id="poet_3">
        <label for="poet_3" class="priority-picker-label">Licymnius</label>
	
        <input type="radio" value="2" name="city" id="poet_52">
        <label for="poet_52" class="priority-picker-label">Magnes</label>

		<input type="radio" value="0" name="city" id="poet_1">
        <label for="poet_1" class="priority-picker-label">Melanippides</label>
		
        <input type="radio" value="1" name="city" id="poet_126">
        <label for="poet_126" class="priority-picker-label">Philiadas</label>
	
        <input type="radio" value="1" name="city" id="poet_24">
        <label for="poet_24" class="priority-picker-label">Philoxenus of Cythera</label>
	
        <input type="radio" value="2" name="city" id="poet_5">
        <label for="poet_5" class="priority-picker-label">Phrynis</label>
	
        <input type="radio" value="2" name="city" id="poet_149">
        <label for="poet_149" class="priority-picker-label">Pindar</label>
	
		<input type="radio" value="0" name="city" id="poet_26">
        <label for="poet_26" class="priority-picker-label">Polyidus</label>
	
        <input type="radio" value="2" name="city" id="poet_129">
        <label for="poet_129" class="priority-picker-label">Pratinas</label>
	
        <input type="radio" value="1" name="city" id="poet_2">
        <label for="poet_2" class="priority-picker-label">Pronomus</label>
	
        <input type="radio" value="2" name="city" id="poet_131">
        <label for="poet_131" class="priority-picker-label">Sacadas</label>
	
        <input type="radio" value="2" name="city" id="poet_132">
        <label for="poet_132" class="priority-picker-label">Sappho</label>
	
        <input type="radio" value="2" name="city" id="poet_134">
        <label for="poet_134" class="priority-picker-label">Semonides</label>
		
        <input type="radio" value="2" name="city" id="poet_135">
        <label for="poet_135" class="priority-picker-label">Simonides</label>
	
        <input type="radio" value="2" name="city" id="poet_136">
        <label for="poet_136" class="priority-picker-label">Solon</label>
	
        <input type="radio" value="2" name="city" id="poet_137">
        <label for="poet_137" class="priority-picker-label">Sophocles</label>
		
        <input type="radio" value="2" name="city" id="poet_138">
        <label for="poet_138" class="priority-picker-label">Stesichorus</label>
	
        <input type="radio" value="2" name="city" id="poet_139">
        <label for="poet_139" class="priority-picker-label">Susarion</label>
	
        <input type="radio" value="2" name="city" id="poet_7">
        <label for="poet_7" class="priority-picker-label">Telestes</label>
	
        <input type="radio" value="2" name="city" id="poet_141">
        <label for="poet_141" class="priority-picker-label">Terpander</label>
	
        <input type="radio" value="2" name="city" id="poet_142">
        <label for="poet_142" class="priority-picker-label">Thaletas</label>
	
        <input type="radio" value="0" name="city" id="poet_45">
        <label for="poet_45" class="priority-picker-label">Thespis</label>
	
        <input type="radio" value="1" name="city" id="poet_144">
        <label for="poet_144" class="priority-picker-label">Timocreon</label>
		
        <input type="radio" value="1" name="city" id="poet_6">
        <label for="poet_6" class="priority-picker-label">Timotheus</label>
	
        <input type="radio" value="2" name="city" id="poet_145">
        <label for="poet_145" class="priority-picker-label">Tyrtaeus</label>
	
        <input type="radio" value="2" name="city" id="poet_148">
        <label for="poet_148" class="priority-picker-label">Xenophanes</label>
	
        <input type="radio" value="2" name="city" id="poet_18">
        <label for="poet_18" class="priority-picker-label" style="text-transform: none;">-es</label>
      </fieldset>
    </div>
    
    <div class="buttonContainer" style="background: white; height: 150px;">            
      <fieldset style="border: none;" id="instrumentForm" class="instrumentForm">
        <div style="color:gray;padding-right:5px;display: inline-block;margin-top: 3px;" >PLACES (<span style="color: #fc1804;">to</span>/<span style="color: #551A8B;">from</span>): </div>
	
        <input type="radio" value="0" name="city" id="destination_65">
        <label for="destination_65" class="instrument-picker-label">Abdera</label>
	
        <input type="radio" value="0" name="city" id="destination_79">
        <label for="destination_79" class="instrument-picker-label">Akragas</label>
	
        <input type="radio" value="0" name="city" id="destination_77">
        <label for="destination_77" class="instrument-picker-label">Amorgos</label>

        <input type="radio" value="0" name="city" id="destination_59">
        <label for="destination_59" class="genre-picker-label">Antissa</label>
		
        <input type="radio" value="0" name="city" id="destination_54">
        <label for="destination_54" class="instrument-picker-label">Arcadia</label>
	
        <input type="radio" value="0" name="city" id="destination_38">
        <label for="destination_38" class="instrument-picker-label">Argos</label>
	
        <input type="radio" value="0" name="city" id="destination_2">
        <label for="destination_2" class="instrument-picker-label">Athens</label>
	
        <input type="radio" value="1" name="city" id="destination_4">
        <label for="destination_4" class="instrument-picker-label">Chalcis</label>

        <input type="radio" value="1" name="city" id="destination_6">
        <label for="destination_6" class="genre-picker-label">Chios</label>
	
        <input type="radio" value="2" name="city" id="destination_75">
        <label for="destination_75" class="instrument-picker-label">Clazomenae</label>
	
        <input type="radio" value="0" name="city" id="destination_20">
        <label for="destination_20" class="instrument-picker-label">Colophon</label>
	
        <input type="radio" value="0" name="city" id="destination_48">
        <label for="destination_48" class="instrument-picker-label">Corinth</label>
		
        <input type="radio" value="2" name="city" id="destination_35">
        <label for="destination_35" class="genre-picker-label">Cythera</label>
	
		<input type="radio" value="2" name="city" id="destination_5">
        <label for="destination_5" class="instrument-picker-label">Delos</label>
	
        <input type="radio" value="0" name="city" id="destination_30">
        <label for="destination_30" class="instrument-picker-label">Delphi</label>
		
		<input type="radio" value="0" name="city" id="destination_32">
        <label for="destination_32" class="genre-picker-label">Elis</label>
	
        <input type="radio" value="1" name="city" id="destination_11">
        <label for="destination_11" class="instrument-picker-label">Ephesus</label>
		
        <input type="radio" value="1" name="city" id="destination_56">
        <label for="destination_56" class="genre-picker-label">Eresos</label>
	
        <input type="radio" value="1" name="city" id="destination_50">
        <label for="destination_50" class="genre-picker-label">Erythrae</label>
	
        <input type="radio" value="0" name="city" id="destination_78">
        <label for="destination_78" class="instrument-picker-label">Gela</label>
		
        <input type="radio" value="1" name="city" id="destination_60">
        <label for="destination_60" class="genre-picker-label">Gortyn</label>
	
        <input type="radio" value="0" name="city" id="destination_16">
        <label for="destination_16" class="instrument-picker-label">Helicon</label>
	
        <input type="radio" value="0" name="city" id="destination_74">
        <label for="destination_74" class="instrument-picker-label">Heracleia (Trachinea)</label>
		
        <input type="radio" value="1" name="city" id="destination_31">
        <label for="destination_31" class="genre-picker-label">Hermione</label>
		
        <input type="radio" value="1" name="city" id="destination_23">
        <label for="destination_23" class="genre-picker-label">Himera</label>
	
        <input type="radio" value="0" name="city" id="destination_73">
        <label for="destination_73" class="instrument-picker-label">Ikaros</label>
		
        <input type="radio" value="1" name="city" id="destination_46">
        <label for="destination_46" class="genre-picker-label">Ioulis (Ceos)</label>
	
        <input type="radio" value="0" name="city" id="destination_64">
        <label for="destination_64" class="instrument-picker-label">Katane</label>
	
        <input type="radio" value="0" name="city" id="destination_81">
        <label for="destination_81" class="instrument-picker-label">Krannon</label>
			
        <input type="radio" value="2" name="city" id="destination_86">
        <label for="destination_86" class="instrument-picker-label">Kynoskephalai</label>
	
        <input type="radio" value="2" name="city" id="destination_7">
        <label for="destination_7" class="instrument-picker-label">Leontini</label>
		
        <input type="radio" value="1" name="city" id="destination_47">
        <label for="destination_47" class="genre-picker-label">Leros</label>
	
        <input type="radio" value="0" name="city" id="destination_21">
        <label for="destination_21" class="instrument-picker-label">Leucas</label>
	
		<input type="radio" value="2" name="city" id="destination_14">
        <label for="destination_14" class="instrument-picker-label">Locri</label>
	
        <input type="radio" value="0" name="city" id="destination_84">
        <label for="destination_84" class="instrument-picker-label">Locris Ozolia</label>
	
        <input type="radio" value="0" name="city" id="destination_33">
        <label for="destination_33" class="instrument-picker-label">Macedonia</label>
	
        <input type="radio" value="0" name="city" id="destination_44">
        <label for="destination_44" class="instrument-picker-label">Magnesia-ad-Sipylum</label>
	
        <input type="radio" value="0" name="city" id="destination_70">
        <label for="destination_70" class="instrument-picker-label">Mantineia</label>
		
        <input type="radio" value="1" name="city" id="destination_58">
        <label for="destination_58" class="genre-picker-label">Matauria</label>
	
        <input type="radio" value="1" name="city" id="destination_17">
        <label for="destination_17" class="genre-picker-label">Megara</label>
	
        <input type="radio" value="2" name="city" id="destination_1">
        <label for="destination_1" class="genre-picker-label">Melos</label>
	
        <input type="radio" value="0" name="city" id="destination_49">
        <label for="destination_49" class="instrument-picker-label">Messena</label>
		
        <input type="radio" value="1" name="city" id="destination_45">
        <label for="destination_45" class="genre-picker-label">Methymna</label>
	
        <input type="radio" value="0" name="city" id="destination_9">
        <label for="destination_9" class="instrument-picker-label">Miletus</label>
		
        <input type="radio" value="1" name="city" id="destination_8">
        <label for="destination_8" class="genre-picker-label">Mytilene</label>
	
        <input type="radio" value="0" name="city" id="destination_66">
        <label for="destination_66" class="instrument-picker-label">Naxos</label>
	
        <input type="radio" value="0" name="city" id="destination_87">
        <label for="destination_87" class="instrument-picker-label">Olympia</label>
	
        <input type="radio" value="0" name="city" id="destination_83">
        <label for="destination_83" class="instrument-picker-label">Pallantion</label>
	
        <input type="radio" value="0" name="city" id="destination_39">
        <label for="destination_39" class="instrument-picker-label">Paros</label>
	
        <input type="radio" value="0" name="city" id="destination_71">
        <label for="destination_71" class="instrument-picker-label">Pellene</label>
	
        <input type="radio" value="0" name="city" id="destination_85">
        <label for="destination_85" class="instrument-picker-label">Persepolis</label>
	
        <input type="radio" value="0" name="city" id="destination_80">
        <label for="destination_80" class="instrument-picker-label">Pharsalos</label>
		
        <input type="radio" value="1" name="city" id="destination_55">
        <label for="destination_55" class="genre-picker-label">Phleious</label>
	
        <input type="radio" value="1" name="city" id="destination_15">
        <label for="destination_15" class="instrument-picker-label">Rhegium</label>
		
        <input type="radio" value="1" name="city" id="destination_61">
        <label for="destination_61" class="genre-picker-label">Rhodes</label>
	
        <input type="radio" value="0" name="city" id="destination_82">
        <label for="destination_82" class="instrument-picker-label">Salamis</label>
	
        <input type="radio" value="0" name="city" id="destination_41">
        <label for="destination_41" class="instrument-picker-label">Samos</label>
	
        <input type="radio" value="0" name="city" id="destination_43">
        <label for="destination_43" class="instrument-picker-label">Sardis</label>
		
        <input type="radio" value="2" name="city" id="destination_12">
        <label for="destination_12" class="genre-picker-label">Selinus</label>
	
		<input type="radio" value="2" name="city" id="destination_22">
        <label for="destination_22" class="genre-picker-label">Selymbria</label>
	
        <input type="radio" value="0" name="city" id="destination_68">
        <label for="destination_68" class="instrument-picker-label">Sicily</label>
	
        <input type="radio" value="2" name="city" id="destination_13">
        <label for="destination_13" class="instrument-picker-label">Sicyon</label>
	
        <input type="radio" value="0" name="city" id="destination_67">
        <label for="destination_67" class="instrument-picker-label">Siris</label>
		
        <input type="radio" value="1" name="city" id="destination_36">
        <label for="destination_36" class="genre-picker-label">Smyrna</label>
	
        <input type="radio" value="0" name="city" id="destination_26">
        <label for="destination_26" class="instrument-picker-label">Soli (Cilicia)</label>

        <input type="radio" value="0" name="city" id="destination_63">
        <label for="destination_63" class="instrument-picker-label">Soli (Cyprus)</label>
	
		<input type="radio" value="2" name="city" id="destination_10">
        <label for="destination_10" class="instrument-picker-label">Sparta</label>
	
        <input type="radio" value="2" name="city" id="destination_18">
        <label for="destination_18" class="instrument-picker-label">Syracuse</label>
	
        <input type="radio" value="0" name="city" id="destination_19">
        <label for="destination_19" class="instrument-picker-label">Tainaron</label>
	
		<input type="radio" value="2" name="city" id="destination_19">
        <label for="destination_19" class="instrument-picker-label">Tarentum</label>
		
        <input type="radio" value="1" name="city" id="destination_42">
        <label for="destination_42" class="genre-picker-label">Teos</label>
	
        <input type="radio" value="0" name="city" id="destination_40">
        <label for="destination_40" class="instrument-picker-label">Thasos</label>
	
        <input type="radio" value="0" name="city" id="destination_3">
        <label for="destination_3" class="instrument-picker-label">Thebes</label>

        <input type="radio" value="0" name="city" id="destination_76">
        <label for="destination_76" class="instrument-picker-label">Thespiai</label>
		
        <input type="radio" value="1" name="city" id="destination_34">
        <label for="destination_34" class="genre-picker-label">Thessaly</label>
	
        <input type="radio" value="0" name="city" id="destination_72">
        <label for="destination_72" class="instrument-picker-label">Thurii</label>
      </fieldset>
    </div>
    
    <div class="buttonContainer" style="background: white;">            
      <fieldset style="border: none;" id="genreForm" class="genreForm">
        <div style="color:gray;padding-right:5px;display: inline-block;margin-top: 3px;" >GEOGRAPHICAL REGION (<span style="color: #fc1804;">to</span>/<span style="color: #551A8B;">from</span>): </div>

        <input type="radio" value="0" name="city" id="region_1">
        <label for="region_1" class="genre-picker-label">Magna Graecia</label>

		<input type="radio" value="0" name="city" id="region_2">
        <label for="region_2" class="genre-picker-label">Mainland Greece</label>
	
        <input type="radio" value="0" name="city" id="region_3">
        <label for="region_3" class="genre-picker-label">Aegean Islands</label>
		
        <input type="radio" value="0" name="city" id="region_4">
        <label for="region_4" class="genre-picker-label">Asia Minor</label>		
	
      </fieldset>
    </div>
	
    <div class="buttonContainer" style="background: white; height: 100px;">            
      <fieldset style="border: none;" id="genreForm" class="genreForm">
        <div style="color:gray;padding-right:5px;display: inline-block;margin-top: 3px;" >SMALL GEOGRAPHICAL REGION (<span style="color: #fc1804;">to</span>/<span style="color: #551A8B;">from</span>): </div>

		<input type="radio" value="0" name="city" id="small_region_2">
        <label for="small_region_2" class="genre-picker-label">Attica</label>
	
        <input type="radio" value="0" name="city" id="small_region_3">
        <label for="small_region_3" class="genre-picker-label">Boeotia</label>
		
        <input type="radio" value="0" name="city" id="small_region_4">
        <label for="small_region_4" class="genre-picker-label">Central Greece</label>
		
        <input type="radio" value="0" name="city" id="small_region_17">
        <label for="small_region_17" class="genre-picker-label">Crete</label>
		
        <input type="radio" value="0" name="city" id="small_region_1">
        <label for="small_region_1" class="genre-picker-label">Cyclades & western Aegean Islands</label>
		
        <input type="radio" value="0" name="city" id="small_region_18">
        <label for="small_region_18" class="genre-picker-label">Cyprus</label>	
		
		<input type="radio" value="0" name="city" id="small_region_15">
        <label for="small_region_15" class="genre-picker-label">Dodecanese</label>
		
        <input type="radio" value="0" name="city" id="small_region_19">
        <label for="small_region_19" class="genre-picker-label">Ionian Sea</label>
		
        <input type="radio" value="0" name="city" id="small_region_14">
        <label for="small_region_14" class="genre-picker-label">Lydia</label>
		
		<input type="radio" value="0" name="city" id="small_region_11">
        <label for="small_region_11" class="genre-picker-label">Northern Greece</label>
		
        <input type="radio" value="0" name="city" id="small_region_8">
        <label for="small_region_8" class="genre-picker-label">North-eastern Aegean</label>

        <input type="radio" value="0" name="city" id="small_region_9">
        <label for="small_region_9" class="genre-picker-label">Peloponnese</label>

		<input type="radio" value="0" name="city" id="small_region_7">
        <label for="small_region_7" class="genre-picker-label">Sicily</label>
	
        <input type="radio" value="0" name="city" id="small_region_12">
        <label for="small_region_12" class="genre-picker-label">Thessaly</label>
		
      </fieldset>
    </div>
	
    <div class="buttonContainer" style="background: white;">            
      <fieldset style="border: none;" id="genreForm" class="genreForm">
        <div style="color:gray;padding-right:5px;display: inline-block;margin-top: 3px;" >POLITICAL SYSTEM (<span style="color: #fc1804;">to</span>/<span style="color: #551A8B;">from</span>): </div>

        <input type="radio" value="0" name="city" id="gov_3">
        <label for="gov_3" class="genre-picker-label">Democracy</label>

		<input type="radio" value="0" name="city" id="gov_4">
        <label for="gov_4" class="genre-picker-label">Kingship</label>
	
        <input type="radio" value="0" name="city" id="gov_7">
        <label for="gov_7" class="genre-picker-label">Mixed</label>
		
        <input type="radio" value="0" name="city" id="gov_1">
        <label for="gov_1" class="genre-picker-label">Oligarchy</label>
		
        <input type="radio" value="0" name="city" id="gov_2">
        <label for="gov_2" class="genre-picker-label">Tyranny</label>		
	
      </fieldset>
    </div></div>
	
    <div style="width: 320px; margin: 0 auto; margin-top: 2px" id="slider"></div>
    
  </div>
  </div>
  </div>
  </div>  
    
    <!-- include google maps library *before* load cartodb.js -->
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <!-- include cartodb.js library -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.uncompressed.js"></script>
	
    <script src="jquery-1.11.2.js"></script>
    <script src="jquery-ui.js"></script>
    <script src="jQRangeSlider-withRuler-min.js"></script>
	
    <script>
    //<!--
      $("#slider").rangeSlider({
        bounds:{min: -700, max: -400},
		defaultValues:{min: -700, max: -400},
		range: {min: 25},  
		step: 50,
		arrows: false,
		formatter:function(val){
			  var value = -val;
			  return value.toString() + " BCE";
		},
		scales: [
		// Primary scale
		{
		  first: function(val){ return val; },
		  next: function(val){ return val + 50; },
		  stop: function(val){ return false; },
		  label: function(val){ return -val; },
		  format: function(tickContainer, tickStart, tickEnd){ 
		  tickContainer.addClass("myCustomClass");
		  }
		}]
	  });
    //-->
    </script>  

    <script>

	function updateQuery(vis, layers) {

	  var firstCall = true;
	  var govCall = false;
	  var dateFirstCall;
	  var i = 0;
	  var query1;
	  var query2;
	  var sublayer1 = layers[1].getSubLayer(0);
	  var sublayer2 = layers[1].getSubLayer(1);
	  var css1;
	  var css2;
          
	  sublayer1.setInteraction(true);
	    
	    // choose query for lines data
		query1 = "SELECT city_city_lines.*, s.birth_city_governmentid, s.other_city_governmentid, s.count, s.poets_names, s.poets_info FROM city_city_lines JOIN ( SELECT s.birth_cityid, s.other_cityid, min(s.birth_city_governmentid) as birth_city_governmentid, min(s.other_city_governmentid) as other_city_governmentid, Count(s.poetid) AS count, (string_agg('<span style=\"color:#B81609\">' || s.poets_cities_rank || '</span>. ' || s.poet_name , ', ' order BY s.poets_cities_rank)) AS poets_names, (string_agg('<p><span style=\"color:#B81609\">' || s.poets_cities_rank || '</span>. ' || s.poet_name || '. Governments: ' || s.grouped_government || '. Dates: ' || s.date_names || '. Genre(s): ' || s.genre_names || '. Source(s): ' || s.sources , '</p>' ORDER BY s.poets_cities_rank)) AS poets_info FROM ( SELECT birth_cityid, other_cityid, poetid, poet_name, date_names, sources, COALESCE(instrument_names, 'Unknown') AS instrument_names, COALESCE(genre_names, 'Unknown') AS genre_names, string_agg(birth_city_government || '->' || other_city_government, ', ') AS grouped_government, min(birth_city_governmentid) as birth_city_governmentid, min(other_city_governmentid) as other_city_governmentid, rank() OVER (partition BY p.birth_cityid, p.other_cityid ORDER BY p.poet_name ASC) AS poets_cities_rank FROM ( SELECT DISTINCT poets_lines.* FROM poets_lines, dates WHERE ";
		css1 = "/** color visualization */ #poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 4; } [count<=3] { line-width: 3; } [count<=2] { line-width: 2; } [count<=1] { line-width: 1; } line-opacity: 0.7; line-color: #fc1804; marker-fill: #fc1804; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 5; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); } }";
	    firstCall = true;
	    for (i=1; i <= 200; i++) {		
		    if($('#poet_'+i).is(':checked')) {
			    if(firstCall == true) {
				    firstCall = false;
				    query1 = query1 + [
					    " poets_lines.poetid = ",
					    i,
					    " and "
				    ].join("");
					css1="#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { line-width: 3; line-opacity: 0.7; line-color: #fc1804; marker-fill: #fc1804; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 10; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); } }";
			    }
			    else {
				    query1 = query1 + "OR poetid = " + i + " ";
			    }
		    }
		    if($('#destination_'+i).is(':checked')) {
			    if(firstCall == true) {
				    firstCall = false;
				    query1 = query1 + [
					    " (poets_lines.other_cityid = ",
					    i,
					    " OR poets_lines.birth_cityid = ",
						i,
						") and "
				    ].join("");
					css1= [
					"#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 12; } [count<=3] { line-width: 9; } [count<=2] { line-width: 6; } [count<=1] { line-width: 3; }  line-opacity: 0.7; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 10; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); [birth_cityid=",
					i,
					"] { line-color: #551A8B; marker-fill: #551A8B; } [other_cityid = ",
					i,
					"] { line-color: #fc1804; marker-fill: #fc1804; } } }"				
				    ].join("");
			    }
		    }
		    if($('#small_region_'+i).is(':checked')) {
			    if(firstCall == true) {
				    firstCall = false;
				    query1 = query1 + [
					    " (poets_lines.birth_regionid = ",
					    i,
					    " OR poets_lines.other_regionid = ",
						i,
						") and "
				    ].join("");
					css1= [
					"#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 12; } [count<=3] { line-width: 9; } [count<=2] { line-width: 6; } [count<=1] { line-width: 3; }  line-opacity: 0.7; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 10; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); [birth_regionid=",
					i,
					"] { line-color: #551A8B; marker-fill: #551A8B; } [other_regionid = ",
					i,
					"] { line-color: #fc1804; marker-fill: #fc1804; } } }"				
				    ].join("");
			    }
		    }
		    if($('#gov_'+i).is(':checked')) {
			    if(firstCall == true) {
				    firstCall = false;
				    query1 = query1 + [
					    " (poets_lines.other_city_governmentid = ",
					    i,
					    " OR poets_lines.birth_city_governmentid = ",
						i,
						" "
				    ].join("");
					//democracy
					if($('#gov_3').is(':checked')) query1 = query1 + "or poets_lines.other_city_governmentid = 10 OR poets_lines.birth_city_governmentid = 10 ";
					// oligarchy
					if($('#gov_1').is(':checked')) query1 = query1 + "or poets_lines.other_city_governmentid = 10 OR poets_lines.birth_city_governmentid = 10 or poets_lines.other_city_governmentid = 9 OR poets_lines.birth_city_governmentid = 9 ";
					// tyranny
					if($('#gov_2').is(':checked')) query1 = query1 + "or poets_lines.other_city_governmentid = 9 OR poets_lines.birth_city_governmentid = 9 ";					
					query1 = query1 + ") and"
					
					css1= [
					"#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 4; } [count<=3] { line-width: 3; } [count<=2] { line-width: 2; } [count<=1] { line-width: 1; }  line-opacity: 0.7; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 5; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); [birth_city_governmentid=",
					i].join("");
					
					if($('#gov_3').is(':checked')) css1 = css1 + "],[birth_city_governmentid=10";
					// oligarchy
					if($('#gov_1').is(':checked')) css1 = css1 + "],[birth_city_governmentid=9],[birth_city_governmentid=10";
					// tyranny
					if($('#gov_2').is(':checked')) css1 = css1 + "],[birth_city_governmentid=9";
					
					css1 = css1 + [
					"] { line-color: #551A8B; marker-fill: #551A8B; } [other_city_governmentid = ",
					i].join("");
					
					if($('#gov_3').is(':checked')) css1 = css1 + "],[other_city_governmentid=10";
					// oligarchy
					if($('#gov_1').is(':checked')) css1 = css1 + "],[other_city_governmentid=9],[other_city_governmentid=10";
					// tyranny
					if($('#gov_2').is(':checked')) css1 = css1 + "],[other_city_governmentid=9";					
					
					css1 = css1 + "] { line-color: #fc1804; marker-fill: #fc1804; } } }";				
			    }
		    }
	    }
		if($('#region_1').is(':checked')) query1 = query1 + " (poets_lines.birth_regionid = 7 or poets_lines.birth_regionid = 10 or poets_lines.other_regionid = 7 or poets_lines.other_regionid = 10) and ";
		if($('#region_2').is(':checked')) query1 = query1 + " (poets_lines.birth_regionid = 12 or poets_lines.other_regionid = 12 or poets_lines.birth_regionid = 11 or poets_lines.other_regionid = 11 or poets_lines.birth_regionid = 2 or poets_lines.birth_regionid = 3 or poets_lines.birth_regionid = 4 or poets_lines.birth_regionid = 9 or poets_lines.other_regionid = 2 or poets_lines.other_regionid = 3 or poets_lines.other_regionid = 4 or poets_lines.other_regionid = 9) and ";
		if($('#region_3').is(':checked')) query1 = query1 + " (poets_lines.birth_regionid = 19 or poets_lines.other_regionid = 19 or poets_lines.birth_regionid = 1 or poets_lines.birth_regionid = 8 or poets_lines.birth_regionid = 15 or poets_lines.birth_regionid = 17 or poets_lines.birth_regionid = 13 or poets_lines.other_regionid = 15 or poets_lines.other_regionid = 1 or poets_lines.other_regionid = 8 or poets_lines.other_regionid = 17 or poets_lines.other_regionid = 13) and ";
		if($('#region_4').is(':checked')) query1 = query1 + " (poets_lines.birth_regionid = 6 or poets_lines.birth_regionid = 14 or poets_lines.birth_regionid = 16 or other_regionid = 6 or other_regionid = 14 or other_regionid = 16) and ";
		dateFirstCall = true;
		for (i=-$("#slider").rangeSlider("values").min; i >= -$("#slider").rangeSlider("values").max; i=i-50) {		
		  if(dateFirstCall == true) {
		    dateFirstCall = false;
		    query1 = query1 + [
		      " poets_lines.poetid = dates.poetid ",
		      "AND ( ",
		      "dates.date='",
		      i,
		      "' "
		    ].join("");
		  }
		  else {
			  query1 = query1 + "OR dates.date = '" + i + "' ";
		  }
		}
		query1 = query1 + ")";
		query1 = query1 + ") p GROUP BY birth_cityid, other_cityid, poetid, poet_name, date_names, instrument_names, sources, genre_names) s GROUP BY s.birth_cityid, s.other_cityid ) s ON city_city_lines.birth_cityid = s.birth_cityid and city_city_lines.other_cityid = s.other_cityid";
		
		if (firstCall == false) {} 
	    else if($('#region_1').is(':checked')) {
		  css1="#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 4; } [count<=3] { line-width: 3; } [count<=2] { line-width: 2; } [count<=1] { line-width: 1; } line-opacity: 0.7; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 5; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); [birth_regionid = 7],[birth_regionid = 10] { line-color: #551A8B; marker-fill: #551A8B; } [other_regionid = 7],[other_regionid = 10] { line-color: #fc1804; marker-fill: #fc1804; } } }";
		}
	    else if($('#region_2').is(':checked')) {
		  css1="#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 4; } [count<=3] { line-width: 3; } [count<=2] { line-width: 2; } [count<=1] { line-width: 1; } line-opacity: 0.7; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 5; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); [birth_regionid = 2],[birth_regionid = 3],[birth_regionid = 4],[birth_regionid=9],[birth_regionid=11],[birth_regionid=12] { line-color: #551A8B; marker-fill: #551A8B; } [other_regionid = 2],[other_regionid = 3],[other_regionid = 4],[other_regionid=9],[other_regionid=11],[other_regionid=12] { line-color: #fc1804; marker-fill: #fc1804; } } }";
		}
	    else if($('#region_3').is(':checked')) {
		  css1="#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 4; } [count<=3] { line-width: 3; } [count<=2] { line-width: 2; } [count<=1] { line-width: 1; } line-opacity: 0.7; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 5; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); [birth_regionid = 19],[birth_regionid = 1],[birth_regionid = 8],[birth_regionid=15],[birth_regionid=17],[birth_regionid=13] { line-color: #551A8B; marker-fill: #551A8B; } [other_regionid = 19],[other_regionid = 15],[other_regionid = 1],[other_regionid=8],[other_regionid=17],[other_regionid=13] { line-color: #fc1804; marker-fill: #fc1804; } } }";
		}
	    else if($('#region_4').is(':checked')) {
		  css1="#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 4; } [count<=3] { line-width: 3; } [count<=2] { line-width: 2; } [count<=1] { line-width: 1; } line-opacity: 0.7; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 5; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); [birth_regionid = 6],[birth_regionid = 14],[birth_regionid = 16] { line-color: #551A8B; marker-fill: #551A8B; } [other_regionid = 6],[other_regionid = 14],[other_regionid = 16] { line-color: #fc1804; marker-fill: #fc1804; } } }";
		}
		else css1="#poets_lines { ::hover { line-width: 10; line-opacity: 0; } ::visible { [count<=4] { line-width: 4; } [count<=3] { line-width: 3; } [count<=2] { line-width: 2; } [count<=1] { line-width: 1; } line-opacity: 0.7; line-color: #fc1804; marker-fill: #fc1804; marker-file: url('http://web.stanford.edu/group/lyricmapping/arrow-16.svg'); marker-width: 5; marker-placement: point; marker-transform: rotate([arrow_angle]+90, 0, 0); } }";

		console.log(query1);
		console.log(css1);
	    sublayer1.setSQL(query1);
		sublayer1.setCartoCSS(css1);
		
	    // choose query for cities data
	    query2 = "SELECT c.* FROM cities as c, (" + query1 + ") selected_lines where (c.cityid = selected_lines.birth_cityid or c.cityid = selected_lines.other_cityid) ";
		if($('#region_1').is(':checked')) query2 = query2 + " and (c.regionid = 7 or c.regionid = 10)";
		if($('#region_2').is(':checked')) query2 = query2 + " and (c.regionid = 2 or c.regionid = 3 or c.regionid = 4 or c.regionid = 9 or c.regionid=11 or c.regionid=12)";
		if($('#region_3').is(':checked')) query2 = query2 + " and (c.regionid = 1 or c.regionid = 8 or c.regionid = 15 or c.regionid = 17 or c.regionid = 13 or c.regionid = 19)";
		if($('#region_4').is(':checked')) query2 = query2 + " and (c.regionid = 6 or c.regionid = 14 or c.regionid = 16)";	 
		 
	    console.log(query2);
	    sublayer2.setSQL(query2); 	  
	}

//	  }
	
    function createSelector(vis, layers) {
        var sql = new cartodb.SQL({ user: 'greeklyricpoets' });
        var $options = $('#controlbar input');
		
		$options.click(function(e) {
			updateQuery(vis, layers);		  
		  });
		$("#slider").bind("valuesChanged", function(e, data) {
		  updateQuery(vis, layers);
		});
    }

	  function createTotalPoetsQuery() {
		var query = [
			"SELECT ",
			"	cities.cartodb_id, ",
			"	cities.the_geom, ",
			"	cities.the_geom_webmercator, ",
			"	cities.city_name, ",
			"	cities.government, ",
			"	sorted_poets.cityid, ",
			"	COUNT(sorted_poets.cityid) as selected_number, ",
			"	string_agg(sorted_poets.poet_name, ', ') as selected_names, ",
			"   	string_agg(sorted_poets.sources, ', ') as selected_sources, ",
			"	string_agg(sorted_poets.poet_link, ', ') as selected_links ",
			"FROM cities, ",
			"	(SELECT ",
			"		poets.poetid, ",
			"		poets.poet_name, ",
			"		poets.sources, ",
			"		poets.poet_link, ",
			"		poets_cities.cityid ",
			"		FROM poets, poets_cities ",
			"		WHERE poets.poetid = poets_cities.poetid ",
			"		ORDER BY cityid ASC, poet_name ASC) sorted_poets ",
			"WHERE cities.cityid = sorted_poets.cityid ",
			"GROUP BY sorted_poets.cityid, cities.the_geom, cities.the_geom_webmercator, cities.city_name, cities.cartodb_id"
		].join("");
		return query;
	}

	  function createBubbleVisualization(selectedData) {
		var bubble =
			['#cities{',
			  'marker-fill: #B81609;',
			  'marker-line-color: #FFF;',
			  'marker-line-width: 2;',
			  'marker-line-opacity: 1;',
			  'marker-opacity: 0.9;',
			  'marker-placement: point;',
			  'marker-type: ellipse;',
			  'marker-allow-overlap: true;',
			  'marker-clip: false;',
			  'marker-multi-policy: largest;',
			  'marker-width: 10.0;',
			'}',
/*			'#cities::labels ', 
			'[',selectedData,'>=8][zoom>5], ',
			'[',selectedData,'>=2][zoom>6], ',
			'[',selectedData,'>=1][zoom>7] ', 
			'{',
			'  text-name: [city_name];',
			'  text-face-name: "Open Sans Regular";',
			'  text-size: 15;',
			'  text-fill: #000;',
			'  text-allow-overlap: true;',
			'  text-halo-fill: #FFF;',
			'  text-halo-radius: 1;',
			'  text-placement-type: simple;',
			'  text-placements: "N,S,E,W,NE,SE,NW,SW,16,14,12";',
			'  text-dy: 3;',
			'  text-dx: 3;',
			'}',  */
			].join('');
		return bubble;
		}
	
      
      function getParameterByName(name) {
	  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
	  var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	      results = regex.exec(location.search);
	  return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
      }      
	  
      function main() {
        cartodb.createVis('map', 'https://greeklyricpoets.cartodb.com/api/v2/viz/e7a19b14-f80b-11e4-8fde-0e4fddd5de28/viz.json', {
          tiles_loader: true,
          center_lat: 38.95,
          center_lon: 22.38,
          zoom: 6
        })
        .done(function(vis, layers) {
	  // layer 0 is the base layer, layer 1 is cartodb layer
	  var sublayer = layers[1].getSubLayer(0);
	  var sublayer2;
	  var poetid = getParameterByName("poetid");
	  var query = "select * from cities where cityid = 0";
	  var css = createBubbleVisualization("selected_number");

	  layers[1].setQuery("select *, '' as poets_names, '' as poets_info, 1 as count from city_city_lines");	  
	  sublayer.setInteraction(false);
	  
	  layers[1].createSubLayer({sql: query, cartocss: css } );
	  	  
	  createSelector(vis, layers);
        })
        .error(function(err) {
          console.log(err);
        });
      }

      window.onload = main;
    </script>
    
    <script src="bootstrap/js/jquery.js"></script>  
    <script src="bootstrap/js/bootstrap-dropdown.js"></script> 
  </body>
</html>